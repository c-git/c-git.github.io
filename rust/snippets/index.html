
<!DOCTYPE html>
<html lang="en">
<head>
  <script src="https://dev.chester.wykies.com/js/theme.min.js" integrity="sha384-pb++s6uBRKaQv+iAXpgA/H3IlpLZdO14tTwuCI7uXmz4aaZdByoCcM+6BhynMq/1"></script>
  <link rel="stylesheet" href="https://dev.chester.wykies.com/abridge.css?h=1d8271772a1ed466a51f" />
  <meta charset="utf-8" />
  <meta http-equiv="x-ua-compatible" content="ie=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="base" content="https://dev.chester.wykies.com" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <meta name="theme-color" content="#333333" />
  <link rel="manifest" href="https://dev.chester.wykies.com/manifest.min.json" />
  <link rel="apple-touch-icon" sizes="180x180" href="https://dev.chester.wykies.com/favicon-180x180.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="https://dev.chester.wykies.com/favicon-32x32.png" />
  <link rel="alternate" type="application/atom+xml" title="Chester Wyke Atom Feed" href="https://dev.chester.wykies.com/atom.xml" />
  <meta name="robots" content="index, follow" />
  <meta name="googlebot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" />
  <meta name="bingbot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" />
  <title>Snippets | Chester Wyke</title>
  <meta name="author" content="Chester Wyke" />
  <meta name="copyright" content="Chester Wyke" />
  <meta name="description" content="Chester Wyke is a software developer by trade and passion. This is his personal site with information about him and his publicly accessible notes on various topics." />
  <link rel="canonical" href="https://dev.chester.wykies.com/rust/snippets/" />
  <meta name="keywords" content="Chester, Wyke, Software, Developer, Notes" />
  <meta property="og:url" content="https://dev.chester.wykies.com/rust/snippets/" />
  <meta name="twitter:url" content="https://dev.chester.wykies.com/rust/snippets/" />
  <meta property="og:description" content="Chester Wyke is a software developer by trade and passion. This is his personal site with information about him and his publicly accessible notes on various topics." />
  <meta name="twitter:description" content="Chester Wyke is a software developer by trade and passion. This is his personal site with information about him and his publicly accessible notes on various topics." />
  <meta property="og:title" content="Snippets | Chester Wyke" />
  <meta name="twitter:title" content="Snippets | Chester Wyke" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:image" content="https://dev.chester.wykies.com/logo.png" />
  <meta property="og:image" content="https://dev.chester.wykies.com/logo.png" />
  <meta property="og:site_name" content="Chester Wyke" />
  <meta property="og:locale" content="en_US" />
  <meta property="og:type" content="website" />
  <meta property="og:updated_time" content="2025-04-26" />
  <script defer src="https://dev.chester.wykies.com/js/abridge_nopwa.min.js?h=da86cb0a199b3ccbdff1" integrity="sha384-vIpObQoso10COS540XqkYFIjE+P0OwczzYDnC2D28QZ8O6slixwCc+F1xxYZKvFr"></script>
  <noscript><link rel="stylesheet" href="https://dev.chester.wykies.com/nojs.css" /></noscript>
</head>
<body>
  <header>
    <nav>
      <div><big><a href="https://dev.chester.wykies.com" title="Chester Wyke"><img src="https://dev.chester.wykies.com/logo-300x102.png" alt="Logo" width="75" height="32" /> &nbsp; Chester Wyke</a></big></div>
      <div>

        <div>
          <ul><li><a class="s110" href="https://dev.chester.wykies.com/archive/"> Articles </a></li><li><a class="s110" href="https://dev.chester.wykies.com/tags/"> Tags </a></li><i type="reset" id="mode" class="js mode">&#9728;</i></li></ul>
        </div>

        <div>
          <div>
            <form autocomplete=off class="js" name="goSearch" id="searchbox">
              <div class="searchd">
                <input id="searchinput" type="text" placeholder="Search" title="Search" />
                <button type="submit" title="Search" class="si">&#8981;</button>
              </div>
              <div class="results"><div id="suggestions"></div></div>
            </form>
          </div>
        </div>

      </div>
    </nav>
    <hr />
  </header>
  <main>
    <article>
      <h1><a href="https://dev.chester.wykies.com/rust/snippets/">Snippets</a></h1>

      <span class="s95"> Chester Wyke <span class="rpad"></span> September 02, 2023 <span class="rpad"></span>Updated: April 26, 2025 <span class="rpad"></span> #<a href="https://dev.chester.wykies.com/tags/rust/">Rust</a> </span>

    
        <div class="block">
      <div class="blockdiv">
        <a class="b s150" href="https://dev.chester.wykies.com/tags/rust/">Rust (Series)</a><br>
            <a href="https://dev.chester.wykies.com/rust/conditional-compilation/">Conditional Compilation</a><br>
            <a href="https://dev.chester.wykies.com/rust/install/">Install</a><br>
            <a href="https://dev.chester.wykies.com/rust/crate-serde/">Crate Serde</a><br>
            <a href="https://dev.chester.wykies.com/rust/refs/">References</a><br>
            <a href="https://dev.chester.wykies.com/rust/cargo/">Cargo</a><br>
            <a href="https://dev.chester.wykies.com/rust/toolchain/">Toolchain (Nightly)</a><br>
            <a href="https://dev.chester.wykies.com/rust/string-formatting/">String Formatting</a><br>
            <a href="https://dev.chester.wykies.com/rust/time/">Time</a><br>
            <a href="https://dev.chester.wykies.com/rust/crate-tokio/">Crate Tokio</a><br>
            <a href="https://dev.chester.wykies.com/rust/publish-crate/">Publish Crate</a><br>
            <a href="https://dev.chester.wykies.com/rust/rustfmt/">rustfmt</a><br>
            <a href="https://dev.chester.wykies.com/rust/scripts/">Single file script</a><br>
            <a class="scur" href="https://dev.chester.wykies.com/rust/snippets/">Snippets</a><br> 
          
            <a href="https://dev.chester.wykies.com/rust/ci/">CI</a><br>
            <a href="https://dev.chester.wykies.com/rust/pattern-typestate/">Pattern Type State</a><br>
            <a href="https://dev.chester.wykies.com/rust/wasm/">WASM</a><br>
            <a href="https://dev.chester.wykies.com/rust/create-new-crate/">Create New Crate</a><br>
            <a href="https://dev.chester.wykies.com/rust/documentation/">Documentation</a><br>
            <a href="https://dev.chester.wykies.com/rust/json/">JSON</a><br>
            <a href="https://dev.chester.wykies.com/rust/pattern-builder/">Pattern Builder</a><br>
            <a href="https://dev.chester.wykies.com/rust/testing/">Testing</a><br>
            <a href="https://dev.chester.wykies.com/rust/byte-collections/">Working with collections of bytes</a><br>
            <a href="https://dev.chester.wykies.com/rust/thoughts/">Thoughts about rust</a><br>
            <a href="https://dev.chester.wykies.com/rust/areweyet/">Are we yet</a><br>
            <a href="https://dev.chester.wykies.com/rust/std-once/">OnceLock</a><br>
            <a href="https://dev.chester.wykies.com/rust/crate-actix/">Crate Actix Web</a><br>
            <a href="https://dev.chester.wykies.com/rust/stack-overflow/">Stack Overflow</a><br>
            <a href="https://dev.chester.wykies.com/rust/crate-clap/">Crate Clap</a><br>
            <a href="https://dev.chester.wykies.com/rust/crate-poll-promise/">Crate Poll Promise</a><br>
            <a href="https://dev.chester.wykies.com/rust/crate-insta/">Crate Insta</a><br>
            <a href="https://dev.chester.wykies.com/rust/tips/">Tips</a><br>
            <a href="https://dev.chester.wykies.com/rust/create-new-egui-project/">Create new egui project</a><br>
            <a href="https://dev.chester.wykies.com/rust/crate-csv/">Crate CSV</a><br>
            <a href="https://dev.chester.wykies.com/rust/crate-egui/">Crate egui</a><br>
            <a href="https://dev.chester.wykies.com/rust/iterators/">Iterators</a><br>
            <a href="https://dev.chester.wykies.com/rust/crate-tracing-subscriber/">Crate Tracing Subscriber</a><br>
            <a href="https://dev.chester.wykies.com/rust/regex/">Regex</a><br>
            <a href="https://dev.chester.wykies.com/rust/vscode/">vscode</a><br>
            <a href="https://dev.chester.wykies.com/rust/enum-conversion/">Enum Conversion</a><br>
            <a href="https://dev.chester.wykies.com/rust/macros/">Macros</a><br>
            <a href="https://dev.chester.wykies.com/rust/crate-lettre/">lettre</a><br>
            <a href="https://dev.chester.wykies.com/rust/google-apis/">Google APIs</a><br>
      </div>
    </div>


<h1 id="library-candidates"><a class="zola-anchor" href="#library-candidates" aria-label="Anchor link for: library-candidates">Library Candidates</a></h1>
<h2 id="read-number-from-stdin"><a class="zola-anchor" href="#read-number-from-stdin" aria-label="Anchor link for: read-number-from-stdin">Read number from stdin</a></h2>
<p>Source: <a rel="noopener external" target="_blank" href="https://doc.rust-lang.org/book/ch02-00-guessing-game-tutorial.html#handling-invalid-input">https://doc.rust-lang.org/book/ch02-00-guessing-game-tutorial.html#handling-invalid-input</a></p>
<pre class="giallo" style="color: #E1E4E8; background-color: #24292E;"><code data-lang="rust"><span class="giallo-l"><span style="color: #F97583;">use</span><span style="color: #B392F0;"> std</span><span style="color: #F97583;">::</span><span>io;</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span style="color: #F97583;">fn</span><span style="color: #B392F0;"> main</span><span>() {</span></span>
<span class="giallo-l"><span style="color: #B392F0;">    println!</span><span>(</span><span style="color: #9ECBFF;">&quot;Please input a number&quot;</span><span>);</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span style="color: #F97583;">    let mut</span><span> user_input</span><span style="color: #F97583;"> =</span><span style="color: #B392F0;"> String</span><span style="color: #F97583;">::</span><span style="color: #B392F0;">new</span><span>();</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span style="color: #B392F0;">    io</span><span style="color: #F97583;">::</span><span style="color: #B392F0;">stdin</span><span>()</span></span>
<span class="giallo-l"><span style="color: #F97583;">        .</span><span style="color: #B392F0;">read_line</span><span>(</span><span style="color: #F97583;">&amp;mut</span><span> user_input)</span></span>
<span class="giallo-l"><span style="color: #F97583;">        .</span><span style="color: #B392F0;">expect</span><span>(</span><span style="color: #9ECBFF;">&quot;Failed to read line&quot;</span><span>);</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span style="color: #F97583;">    if let</span><span style="color: #B392F0;"> Ok</span><span>(num)</span><span style="color: #F97583;"> =</span><span> user_input</span><span style="color: #F97583;">.</span><span style="color: #B392F0;">trim</span><span>()</span><span style="color: #F97583;">.</span><span style="color: #B392F0;">parse</span><span style="color: #F97583;">::</span><span>&lt;</span><span style="color: #B392F0;">u32</span><span>&gt;() {</span></span>
<span class="giallo-l"><span style="color: #B392F0;">        println!</span><span>(</span><span style="color: #9ECBFF;">&quot;The number entered is {num}&quot;</span><span>);</span></span>
<span class="giallo-l"><span>    }</span></span>
<span class="giallo-l"><span>}</span></span></code></pre><h2 id="read-file-line-by-line"><a class="zola-anchor" href="#read-file-line-by-line" aria-label="Anchor link for: read-file-line-by-line">Read file (line by line)</a></h2>
<p>Source: <a rel="noopener external" target="_blank" href="https://doc.rust-lang.org/rust-by-example/std_misc/file/read_lines.html">https://doc.rust-lang.org/rust-by-example/std_misc/file/read_lines.html</a></p>
<pre class="giallo" style="color: #E1E4E8; background-color: #24292E;"><code data-lang="rust"><span class="giallo-l"><span style="color: #F97583;">use</span><span style="color: #B392F0;"> std</span><span style="color: #F97583;">::</span><span style="color: #B392F0;">error</span><span style="color: #F97583;">::</span><span style="color: #B392F0;">Error</span><span>;</span></span>
<span class="giallo-l"><span style="color: #F97583;">use</span><span style="color: #B392F0;"> std</span><span style="color: #F97583;">::</span><span style="color: #B392F0;">fs</span><span style="color: #F97583;">::</span><span style="color: #B392F0;">File</span><span>;</span></span>
<span class="giallo-l"><span style="color: #F97583;">use</span><span style="color: #B392F0;"> std</span><span style="color: #F97583;">::</span><span style="color: #B392F0;">io</span><span style="color: #F97583;">::</span><span>{</span><span style="color: #79B8FF;">self</span><span>,</span><span style="color: #B392F0;"> BufRead</span><span>};</span></span>
<span class="giallo-l"><span style="color: #F97583;">use</span><span style="color: #B392F0;"> std</span><span style="color: #F97583;">::</span><span style="color: #B392F0;">path</span><span style="color: #F97583;">::</span><span style="color: #B392F0;">Path</span><span>;</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span style="color: #F97583;">fn</span><span style="color: #B392F0;"> main</span><span>()</span><span style="color: #F97583;"> -&gt;</span><span style="color: #B392F0;"> Result</span><span>&lt;(),</span><span style="color: #B392F0;"> Box</span><span>&lt;</span><span style="color: #F97583;">dyn</span><span style="color: #B392F0;"> Error</span><span>&gt;&gt; {</span></span>
<span class="giallo-l"><span style="color: #F97583;">    for</span><span> line</span><span style="color: #F97583;"> in</span><span style="color: #B392F0;"> read_lines</span><span>(</span><span style="color: #9ECBFF;">&quot;filename&quot;</span><span>)</span><span style="color: #F97583;">?</span><span> {</span></span>
<span class="giallo-l"><span style="color: #F97583;">        let</span><span> line</span><span style="color: #F97583;"> =</span><span> line</span><span style="color: #F97583;">?</span><span>;</span></span>
<span class="giallo-l"><span style="color: #B392F0;">        println!</span><span>(</span><span style="color: #9ECBFF;">&quot;{line}&quot;</span><span>);</span></span>
<span class="giallo-l"><span>    }</span></span>
<span class="giallo-l"><span style="color: #B392F0;">    Ok</span><span>(())</span></span>
<span class="giallo-l"><span>}</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span style="color: #6A737D;">// The output is wrapped in a Result to allow matching on errors</span></span>
<span class="giallo-l"><span style="color: #6A737D;">// Returns an Iterator to the Reader of the lines of the file.</span></span>
<span class="giallo-l"><span style="color: #F97583;">fn</span><span style="color: #B392F0;"> read_lines</span><span>&lt;</span><span style="color: #B392F0;">P</span><span style="color: #F97583;">:</span><span style="color: #B392F0;"> AsRef</span><span>&lt;</span><span style="color: #B392F0;">Path</span><span>&gt;&gt;(path</span><span style="color: #F97583;">:</span><span style="color: #B392F0;"> P</span><span>)</span><span style="color: #F97583;"> -&gt;</span><span style="color: #B392F0;"> io</span><span style="color: #F97583;">::</span><span style="color: #B392F0;">Result</span><span>&lt;io</span><span style="color: #F97583;">::</span><span style="color: #B392F0;">Lines</span><span>&lt;io</span><span style="color: #F97583;">::</span><span style="color: #B392F0;">BufReader</span><span>&lt;</span><span style="color: #B392F0;">File</span><span>&gt;&gt;&gt;</span></span>
<span class="giallo-l"><span>{</span></span>
<span class="giallo-l"><span style="color: #F97583;">    let</span><span> file</span><span style="color: #F97583;"> =</span><span style="color: #B392F0;"> File</span><span style="color: #F97583;">::</span><span style="color: #B392F0;">open</span><span>(path)</span><span style="color: #F97583;">?</span><span>;</span></span>
<span class="giallo-l"><span style="color: #B392F0;">    Ok</span><span>(</span><span style="color: #B392F0;">io</span><span style="color: #F97583;">::</span><span style="color: #B392F0;">BufReader</span><span style="color: #F97583;">::</span><span style="color: #B392F0;">new</span><span>(file)</span><span style="color: #F97583;">.</span><span style="color: #B392F0;">lines</span><span>())</span></span>
<span class="giallo-l"><span>}</span></span></code></pre><h2 id="read-file-to-string"><a class="zola-anchor" href="#read-file-to-string" aria-label="Anchor link for: read-file-to-string">Read file to string</a></h2>
<pre class="giallo" style="color: #E1E4E8; background-color: #24292E;"><code data-lang="rust"><span class="giallo-l"><span style="color: #F97583;">fn</span><span style="color: #B392F0;"> main</span><span>()</span><span style="color: #F97583;"> -&gt;</span><span style="color: #B392F0;"> Result</span><span>&lt;(),</span><span style="color: #B392F0;"> Box</span><span>&lt;</span><span style="color: #F97583;">dyn</span><span style="color: #B392F0;"> Error</span><span>&gt;&gt; {</span></span>
<span class="giallo-l"><span style="color: #F97583;">    let</span><span> _</span><span style="color: #F97583;"> =</span><span style="color: #B392F0;"> fs</span><span style="color: #F97583;">::</span><span style="color: #B392F0;">read_to_string</span><span>(</span><span style="color: #9ECBFF;">&quot;filename&quot;</span><span>)</span><span style="color: #F97583;">?</span><span>;</span></span>
<span class="giallo-l"><span style="color: #B392F0;">    Ok</span><span>(())</span></span>
<span class="giallo-l"><span>}</span></span></code></pre><h2 id="write-string-to-a-file"><a class="zola-anchor" href="#write-string-to-a-file" aria-label="Anchor link for: write-string-to-a-file">Write string to a file</a></h2>
<pre class="giallo" style="color: #E1E4E8; background-color: #24292E;"><code data-lang="rust"><span class="giallo-l"><span style="color: #F97583;">use</span><span style="color: #B392F0;"> std</span><span style="color: #F97583;">::</span><span>{</span><span style="color: #B392F0;">error</span><span style="color: #F97583;">::</span><span style="color: #B392F0;">Error</span><span>,</span><span style="color: #B392F0;"> io</span><span style="color: #F97583;">::</span><span style="color: #B392F0;">Write</span><span>,</span><span style="color: #B392F0;"> path</span><span style="color: #F97583;">::</span><span style="color: #B392F0;">Path</span><span>};</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span style="color: #F97583;">fn</span><span style="color: #B392F0;"> main</span><span>()</span><span style="color: #F97583;"> -&gt;</span><span style="color: #B392F0;"> Result</span><span>&lt;(),</span><span style="color: #B392F0;"> Box</span><span>&lt;</span><span style="color: #F97583;">dyn</span><span style="color: #B392F0;"> Error</span><span>&gt;&gt; {</span></span>
<span class="giallo-l"><span style="color: #B392F0;">    write_to_path</span><span>(</span><span style="color: #9ECBFF;">&quot;filename.txt&quot;</span><span>,</span><span style="color: #9ECBFF;"> &quot;text for file&quot;</span><span>)</span><span style="color: #F97583;">?</span><span>;</span></span>
<span class="giallo-l"><span style="color: #B392F0;">    Ok</span><span>(())</span></span>
<span class="giallo-l"><span>}</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span style="color: #F97583;">fn</span><span style="color: #B392F0;"> write_to_path</span><span>&lt;</span><span style="color: #B392F0;">P</span><span style="color: #F97583;">:</span><span style="color: #B392F0;"> AsRef</span><span>&lt;</span><span style="color: #B392F0;">Path</span><span>&gt;&gt;(path</span><span style="color: #F97583;">:</span><span style="color: #B392F0;"> P</span><span>, s</span><span style="color: #F97583;">: &amp;</span><span style="color: #B392F0;">str</span><span>)</span><span style="color: #F97583;"> -&gt;</span><span style="color: #B392F0;"> Result</span><span>&lt;(),</span><span style="color: #B392F0;"> Box</span><span>&lt;</span><span style="color: #F97583;">dyn</span><span style="color: #B392F0;"> Error</span><span>&gt;&gt; {</span></span>
<span class="giallo-l"><span style="color: #F97583;">    let mut</span><span> file</span><span style="color: #F97583;"> =</span><span style="color: #B392F0;"> std</span><span style="color: #F97583;">::</span><span style="color: #B392F0;">fs</span><span style="color: #F97583;">::</span><span style="color: #B392F0;">OpenOptions</span><span style="color: #F97583;">::</span><span style="color: #B392F0;">new</span><span>()</span></span>
<span class="giallo-l"><span style="color: #F97583;">            .</span><span style="color: #B392F0;">write</span><span>(</span><span style="color: #79B8FF;">true</span><span>)</span></span>
<span class="giallo-l"><span style="color: #F97583;">            .</span><span style="color: #B392F0;">create</span><span>(</span><span style="color: #79B8FF;">true</span><span>)</span></span>
<span class="giallo-l"><span style="color: #F97583;">            .</span><span style="color: #B392F0;">truncate</span><span>(</span><span style="color: #79B8FF;">true</span><span>)</span></span>
<span class="giallo-l"><span style="color: #F97583;">            .</span><span style="color: #B392F0;">open</span><span>(path)</span><span style="color: #F97583;">?</span><span>;</span></span>
<span class="giallo-l"><span>    file</span><span style="color: #F97583;">.</span><span style="color: #B392F0;">write_all</span><span>(s</span><span style="color: #F97583;">.</span><span style="color: #B392F0;">as_bytes</span><span>())</span><span style="color: #F97583;">?</span><span>;</span></span>
<span class="giallo-l"><span style="color: #B392F0;">    Ok</span><span>(())</span></span>
<span class="giallo-l"><span>}</span></span></code></pre>
<p>OR with a trait (may not be great for a library as is because it’s very opinionated with regard to overwrite)</p>
<pre class="giallo" style="color: #E1E4E8; background-color: #24292E;"><code data-lang="rust"><span class="giallo-l"><span style="color: #F97583;">use</span><span style="color: #B392F0;"> anyhow</span><span style="color: #F97583;">::</span><span style="color: #B392F0;">Context</span><span style="color: #F97583;"> as</span><span> _;</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span style="color: #F97583;">pub trait</span><span style="color: #B392F0;"> SaveToFile</span><span> {</span></span>
<span class="giallo-l"><span style="color: #6A737D;">    /// Writes the file replacing if it already exists</span></span>
<span class="giallo-l"><span style="color: #F97583;">    fn</span><span style="color: #B392F0;"> write_to_path</span><span>&lt;</span><span style="color: #B392F0;">P</span><span style="color: #F97583;">:</span><span style="color: #B392F0;"> AsRef</span><span>&lt;</span><span style="color: #B392F0;">Path</span><span>&gt;&gt;(</span><span style="color: #F97583;">&amp;</span><span style="color: #79B8FF;">self</span><span>, path</span><span style="color: #F97583;">:</span><span style="color: #B392F0;"> P</span><span>)</span><span style="color: #F97583;"> -&gt;</span><span style="color: #B392F0;"> anyhow</span><span style="color: #F97583;">::</span><span style="color: #B392F0;">Result</span><span>&lt;()&gt;;</span></span>
<span class="giallo-l"><span>}</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span style="color: #F97583;">impl</span><span>&lt;</span><span style="color: #B392F0;">T</span><span style="color: #F97583;">:</span><span style="color: #B392F0;"> AsRef</span><span>&lt;</span><span style="color: #B392F0;">str</span><span>&gt;&gt;</span><span style="color: #B392F0;"> SaveToFile</span><span style="color: #F97583;"> for</span><span style="color: #B392F0;"> T</span><span> {</span></span>
<span class="giallo-l"><span style="color: #F97583;">    fn</span><span style="color: #B392F0;"> write_to_path</span><span>&lt;</span><span style="color: #B392F0;">P</span><span style="color: #F97583;">:</span><span style="color: #B392F0;"> AsRef</span><span>&lt;</span><span style="color: #B392F0;">Path</span><span>&gt;&gt;(</span><span style="color: #F97583;">&amp;</span><span style="color: #79B8FF;">self</span><span>, path</span><span style="color: #F97583;">:</span><span style="color: #B392F0;"> P</span><span>)</span><span style="color: #F97583;"> -&gt;</span><span style="color: #B392F0;"> anyhow</span><span style="color: #F97583;">::</span><span style="color: #B392F0;">Result</span><span>&lt;()&gt; {</span></span>
<span class="giallo-l"><span style="color: #F97583;">        let mut</span><span> file</span><span style="color: #F97583;"> =</span><span style="color: #B392F0;"> std</span><span style="color: #F97583;">::</span><span style="color: #B392F0;">fs</span><span style="color: #F97583;">::</span><span style="color: #B392F0;">OpenOptions</span><span style="color: #F97583;">::</span><span style="color: #B392F0;">new</span><span>()</span></span>
<span class="giallo-l"><span style="color: #F97583;">            .</span><span style="color: #B392F0;">truncate</span><span>(</span><span style="color: #79B8FF;">true</span><span>)</span></span>
<span class="giallo-l"><span style="color: #F97583;">            .</span><span style="color: #B392F0;">write</span><span>(</span><span style="color: #79B8FF;">true</span><span>)</span></span>
<span class="giallo-l"><span style="color: #F97583;">            .</span><span style="color: #B392F0;">create</span><span>(</span><span style="color: #79B8FF;">true</span><span>)</span></span>
<span class="giallo-l"><span style="color: #F97583;">            .</span><span style="color: #B392F0;">open</span><span>(</span><span style="color: #F97583;">&amp;</span><span>path)</span></span>
<span class="giallo-l"><span style="color: #F97583;">            .</span><span style="color: #B392F0;">with_context</span><span>(</span><span style="color: #F97583;">||</span><span> {</span></span>
<span class="giallo-l"><span style="color: #B392F0;">                format!</span><span>(</span></span>
<span class="giallo-l"><span style="color: #9ECBFF;">                    &quot;failed to open file for writing. Filename: {:?}&quot;</span><span>,</span></span>
<span class="giallo-l"><span>                    path</span><span style="color: #F97583;">.</span><span style="color: #B392F0;">as_ref</span><span>()</span></span>
<span class="giallo-l"><span>                )</span></span>
<span class="giallo-l"><span>            })</span><span style="color: #F97583;">?</span><span>;</span></span>
<span class="giallo-l"><span>        file</span><span style="color: #F97583;">.</span><span style="color: #B392F0;">write_all</span><span>(</span><span style="color: #79B8FF;">self</span><span style="color: #F97583;">.</span><span style="color: #B392F0;">as_ref</span><span>()</span><span style="color: #F97583;">.</span><span style="color: #B392F0;">as_bytes</span><span>())</span></span>
<span class="giallo-l"><span style="color: #F97583;">            .</span><span style="color: #B392F0;">with_context</span><span>(</span><span style="color: #F97583;">||</span><span style="color: #B392F0;"> format!</span><span>(</span><span style="color: #9ECBFF;">&quot;failed to write contents to: {:?}&quot;</span><span>, path</span><span style="color: #F97583;">.</span><span style="color: #B392F0;">as_ref</span><span>()))</span><span style="color: #F97583;">?</span><span>;</span></span>
<span class="giallo-l"><span style="color: #B392F0;">        Ok</span><span>(())</span></span>
<span class="giallo-l"><span>    }</span></span>
<span class="giallo-l"><span>}</span></span></code></pre><h2 id="print-without-new-line-and-flush"><a class="zola-anchor" href="#print-without-new-line-and-flush" aria-label="Anchor link for: print-without-new-line-and-flush">Print without new line (and flush)</a></h2>
<p>Note: flush is required as <code>print!()</code> does not automatically flush like <code>println!()</code> does</p>
<pre class="giallo" style="color: #E1E4E8; background-color: #24292E;"><code data-lang="rust"><span class="giallo-l"><span style="color: #B392F0;">print!</span><span>(</span><span style="color: #9ECBFF;">&quot;This may not print when we want unless we flush&quot;</span><span>);</span></span>
<span class="giallo-l"><span style="color: #B392F0;">io</span><span style="color: #F97583;">::</span><span style="color: #B392F0;">stdout</span><span>()</span><span style="color: #F97583;">.</span><span style="color: #B392F0;">flush</span><span>()</span><span style="color: #F97583;">?</span><span>;</span></span></code></pre><h2 id="add-an-extension-to-a-path"><a class="zola-anchor" href="#add-an-extension-to-a-path" aria-label="Anchor link for: add-an-extension-to-a-path">Add an extension to a path</a></h2>
<p>Source: <a rel="noopener external" target="_blank" href="https://users.rust-lang.org/t/append-an-additional-extension/23586/13">https://users.rust-lang.org/t/append-an-additional-extension/23586/13</a></p>
<pre class="giallo" style="color: #E1E4E8; background-color: #24292E;"><code data-lang="rust"><span class="giallo-l"><span style="color: #F97583;">pub trait</span><span style="color: #B392F0;"> PathExtension</span><span> {</span></span>
<span class="giallo-l"><span style="color: #6A737D;">    /// Returns the result of set_extension with the appended extension</span></span>
<span class="giallo-l"><span style="color: #F97583;">    fn</span><span style="color: #B392F0;"> add_extension</span><span>&lt;</span><span style="color: #B392F0;">P</span><span style="color: #F97583;">:</span><span style="color: #B392F0;"> AsRef</span><span>&lt;</span><span style="color: #B392F0;">Path</span><span>&gt;&gt;(</span><span style="color: #F97583;">&amp;mut</span><span style="color: #79B8FF;"> self</span><span>, new_extension</span><span style="color: #F97583;">:</span><span style="color: #B392F0;"> P</span><span>)</span><span style="color: #F97583;"> -&gt;</span><span style="color: #B392F0;"> bool</span><span>;</span></span>
<span class="giallo-l"><span>}</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span style="color: #F97583;">impl</span><span style="color: #B392F0;"> PathExtension</span><span style="color: #F97583;"> for</span><span style="color: #B392F0;"> PathBuf</span><span> {</span></span>
<span class="giallo-l"><span style="color: #F97583;">    fn</span><span style="color: #B392F0;"> add_extension</span><span>&lt;</span><span style="color: #B392F0;">P</span><span style="color: #F97583;">:</span><span style="color: #B392F0;"> AsRef</span><span>&lt;</span><span style="color: #B392F0;">Path</span><span>&gt;&gt;(</span><span style="color: #F97583;">&amp;mut</span><span style="color: #79B8FF;"> self</span><span>, extension</span><span style="color: #F97583;">:</span><span style="color: #B392F0;"> P</span><span>)</span><span style="color: #F97583;"> -&gt;</span><span style="color: #B392F0;"> bool</span><span> {</span></span>
<span class="giallo-l"><span style="color: #F97583;">        match</span><span style="color: #79B8FF;"> self</span><span style="color: #F97583;">.</span><span style="color: #B392F0;">extension</span><span>() {</span></span>
<span class="giallo-l"><span style="color: #B392F0;">            Some</span><span>(ext)</span><span style="color: #F97583;"> =&gt;</span><span> {</span></span>
<span class="giallo-l"><span style="color: #F97583;">                let mut</span><span> ext</span><span style="color: #F97583;"> =</span><span> ext</span><span style="color: #F97583;">.</span><span style="color: #B392F0;">to_os_string</span><span>();</span></span>
<span class="giallo-l"><span>                ext</span><span style="color: #F97583;">.</span><span style="color: #B392F0;">push</span><span>(</span><span style="color: #9ECBFF;">&quot;.&quot;</span><span>);</span></span>
<span class="giallo-l"><span>                ext</span><span style="color: #F97583;">.</span><span style="color: #B392F0;">push</span><span>(extension</span><span style="color: #F97583;">.</span><span style="color: #B392F0;">as_ref</span><span>());</span></span>
<span class="giallo-l"><span style="color: #79B8FF;">                self</span><span style="color: #F97583;">.</span><span style="color: #B392F0;">set_extension</span><span>(ext)</span></span>
<span class="giallo-l"><span>            }</span></span>
<span class="giallo-l"><span style="color: #B392F0;">            None</span><span style="color: #F97583;"> =&gt;</span><span style="color: #79B8FF;"> self</span><span style="color: #F97583;">.</span><span style="color: #B392F0;">set_extension</span><span>(extension</span><span style="color: #F97583;">.</span><span style="color: #B392F0;">as_ref</span><span>()),</span></span>
<span class="giallo-l"><span>        }</span></span>
<span class="giallo-l"><span>    }</span></span>
<span class="giallo-l"><span>}</span></span></code></pre><h2 id="add-commas-to-number-for-display"><a class="zola-anchor" href="#add-commas-to-number-for-display" aria-label="Anchor link for: add-commas-to-number-for-display">Add commas to number for display</a></h2>
<p>NB: To the best of my recollection here is also a crate that provides a more robust implementation</p>
<pre class="giallo" style="color: #E1E4E8; background-color: #24292E;"><code data-lang="rust"><span class="giallo-l"><span style="color: #F97583;">fn</span><span style="color: #B392F0;"> as_string_with_separators</span><span>(value</span><span style="color: #F97583;">:</span><span style="color: #B392F0;"> usize</span><span>)</span><span style="color: #F97583;"> -&gt;</span><span style="color: #B392F0;"> String</span><span> {</span></span>
<span class="giallo-l"><span>    value</span></span>
<span class="giallo-l"><span style="color: #F97583;">        .</span><span style="color: #B392F0;">to_string</span><span>()</span></span>
<span class="giallo-l"><span style="color: #F97583;">        .</span><span style="color: #B392F0;">as_bytes</span><span>()</span></span>
<span class="giallo-l"><span style="color: #F97583;">        .</span><span style="color: #B392F0;">rchunks</span><span>(</span><span style="color: #79B8FF;">3</span><span>)</span></span>
<span class="giallo-l"><span style="color: #F97583;">        .</span><span style="color: #B392F0;">rev</span><span>()</span></span>
<span class="giallo-l"><span style="color: #F97583;">        .</span><span style="color: #B392F0;">map</span><span>(</span><span style="color: #B392F0;">std</span><span style="color: #F97583;">::</span><span style="color: #B392F0;">str</span><span style="color: #F97583;">::</span><span>from_utf8)</span></span>
<span class="giallo-l"><span style="color: #F97583;">        .</span><span style="color: #B392F0;">collect</span><span style="color: #F97583;">::</span><span>&lt;</span><span style="color: #B392F0;">Result</span><span>&lt;</span><span style="color: #B392F0;">Vec</span><span>&lt;</span><span style="color: #F97583;">&amp;</span><span style="color: #B392F0;">str</span><span>&gt;, _&gt;&gt;()</span></span>
<span class="giallo-l"><span style="color: #F97583;">        .</span><span style="color: #B392F0;">unwrap</span><span>()</span></span>
<span class="giallo-l"><span style="color: #F97583;">        .</span><span style="color: #B392F0;">join</span><span>(</span><span style="color: #9ECBFF;">&quot;,&quot;</span><span>)</span></span>
<span class="giallo-l"><span>}</span></span></code></pre><h2 id="replace-escaped-special-characters-with-the-actual-special-characters"><a class="zola-anchor" href="#replace-escaped-special-characters-with-the-actual-special-characters" aria-label="Anchor link for: replace-escaped-special-characters-with-the-actual-special-characters">Replace escaped special characters with the actual special characters</a></h2>
<p>This one feels like there should be a better way but I haven’t needed it so not sure but the <a rel="noopener external" target="_blank" href="https://docs.rs/aho-corasick/latest/aho_corasick/">aho_corasick</a> crate could do multiple find and replace simultaneously instead of sequentially if I recall correctly.</p>
<pre class="giallo" style="color: #E1E4E8; background-color: #24292E;"><code data-lang="rust"><span class="giallo-l"><span style="color: #F97583;">fn</span><span style="color: #B392F0;"> clean_msg</span><span>&lt;</span><span style="color: #B392F0;">S</span><span style="color: #F97583;">:</span><span style="color: #B392F0;"> AsRef</span><span>&lt;</span><span style="color: #B392F0;">str</span><span>&gt;&gt;(msg</span><span style="color: #F97583;">:</span><span style="color: #B392F0;"> S</span><span>)</span><span style="color: #F97583;"> -&gt;</span><span style="color: #B392F0;"> String</span><span> {</span></span>
<span class="giallo-l"><span>    msg</span><span style="color: #F97583;">.</span><span style="color: #B392F0;">as_ref</span><span>()</span><span style="color: #F97583;">.</span><span style="color: #B392F0;">replace</span><span>(</span><span style="color: #9ECBFF;">r&quot;\n&quot;</span><span>,</span><span style="color: #9ECBFF;"> &quot;</span><span style="color: #79B8FF;">\n</span><span style="color: #9ECBFF;">&quot;</span><span>)</span><span style="color: #F97583;">.</span><span style="color: #B392F0;">replace</span><span>(</span><span style="color: #9ECBFF;">r#&quot;\&quot;&quot;#</span><span>,</span><span style="color: #9ECBFF;"> &quot;</span><span style="color: #79B8FF;">\&quot;</span><span style="color: #9ECBFF;">&quot;</span><span>)</span></span>
<span class="giallo-l"><span>}</span></span></code></pre><h1 id="tests"><a class="zola-anchor" href="#tests" aria-label="Anchor link for: tests">Tests</a></h1>
<h2 id="unit-tests"><a class="zola-anchor" href="#unit-tests" aria-label="Anchor link for: unit-tests">Unit tests</a></h2>
<pre class="giallo" style="color: #E1E4E8; background-color: #24292E;"><code data-lang="rust"><span class="giallo-l"><span>#[cfg(test)]</span></span>
<span class="giallo-l"><span style="color: #F97583;">mod</span><span style="color: #B392F0;"> tests</span><span> {</span></span>
<span class="giallo-l"><span style="color: #F97583;">    use</span><span style="color: #79B8FF;"> super</span><span style="color: #F97583;">::*</span><span>;</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span>    #[test]</span></span>
<span class="giallo-l"><span style="color: #F97583;">    fn</span><span style="color: #B392F0;"> it_works</span><span>() {</span></span>
<span class="giallo-l"><span style="color: #F97583;">        let</span><span> result</span><span style="color: #F97583;"> =</span><span style="color: #79B8FF;"> 2</span><span style="color: #F97583;"> +</span><span style="color: #79B8FF;"> 2</span><span>;</span></span>
<span class="giallo-l"><span style="color: #B392F0;">        assert_eq!</span><span>(result,</span><span style="color: #79B8FF;"> 4</span><span>);</span></span>
<span class="giallo-l"><span>    }</span></span>
<span class="giallo-l"><span>}</span></span></code></pre><h2 id="panic-expectation"><a class="zola-anchor" href="#panic-expectation" aria-label="Anchor link for: panic-expectation">Panic expectation</a></h2>
<pre class="giallo" style="color: #E1E4E8; background-color: #24292E;"><code data-lang="rust"><span class="giallo-l"><span>#[should_panic(expected </span><span style="color: #F97583;">=</span><span style="color: #9ECBFF;"> &quot;message seems to need to be on first line of text&quot;</span><span>)]</span></span>
<span class="giallo-l"><span style="color: #F97583;">fn</span><span style="color: #B392F0;"> it_should_panic</span><span>() {}</span></span></code></pre><h2 id="run-cli-app-to-test-it"><a class="zola-anchor" href="#run-cli-app-to-test-it" aria-label="Anchor link for: run-cli-app-to-test-it">Run CLI App to test it</a></h2>
<p>NOTE: Only works from integration tests</p>
<pre class="giallo" style="color: #E1E4E8; background-color: #24292E;"><code data-lang="toml"><span class="giallo-l"><span style="color: #6A737D;"># Cargo.toml</span></span>
<span class="giallo-l"><span>[</span><span style="color: #B392F0;">dev-dependencies</span><span>]</span></span>
<span class="giallo-l"><span>assert_cmd =</span><span style="color: #9ECBFF;"> &quot;2.0.7&quot;</span></span>
<span class="giallo-l"><span>predicates =</span><span style="color: #9ECBFF;"> &quot;2.1.5&quot;</span></span></code></pre><pre class="giallo" style="color: #E1E4E8; background-color: #24292E;"><code data-lang="rust"><span class="giallo-l"><span style="color: #6A737D;">// main.rs</span></span>
<span class="giallo-l"><span style="color: #F97583;">use</span><span style="color: #B392F0;"> std</span><span style="color: #F97583;">::</span><span style="color: #B392F0;">io</span><span style="color: #F97583;">::</span><span style="color: #B392F0;">BufRead</span><span>;</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span style="color: #F97583;">fn</span><span style="color: #B392F0;"> main</span><span>() {</span></span>
<span class="giallo-l"><span style="color: #F97583;">    for</span><span> line</span><span style="color: #F97583;"> in</span><span style="color: #B392F0;"> std</span><span style="color: #F97583;">::</span><span style="color: #B392F0;">io</span><span style="color: #F97583;">::</span><span style="color: #B392F0;">stdin</span><span>()</span><span style="color: #F97583;">.</span><span style="color: #B392F0;">lock</span><span>()</span><span style="color: #F97583;">.</span><span style="color: #B392F0;">lines</span><span>() {</span></span>
<span class="giallo-l"><span style="color: #B392F0;">        println!</span><span>(</span><span style="color: #9ECBFF;">&quot;{}&quot;</span><span>, line</span><span style="color: #F97583;">.</span><span style="color: #B392F0;">expect</span><span>(</span><span style="color: #9ECBFF;">&quot;Unable to read input line&quot;</span><span>));</span></span>
<span class="giallo-l"><span>    }</span></span>
<span class="giallo-l"><span>}</span></span></code></pre><pre class="giallo" style="color: #E1E4E8; background-color: #24292E;"><code data-lang="rust"><span class="giallo-l"><span style="color: #6A737D;">// tests/integration_test.rs</span></span>
<span class="giallo-l"><span style="color: #F97583;">use</span><span style="color: #B392F0;"> assert_cmd</span><span style="color: #F97583;">::</span><span style="color: #B392F0;">prelude</span><span style="color: #F97583;">::*</span><span>;</span><span style="color: #6A737D;"> // Add methods on commands</span></span>
<span class="giallo-l"><span style="color: #F97583;">use</span><span style="color: #B392F0;"> predicates</span><span style="color: #F97583;">::</span><span style="color: #B392F0;">prelude</span><span style="color: #F97583;">::*</span><span>;</span><span style="color: #6A737D;"> // Used for writing assertions</span></span>
<span class="giallo-l"><span style="color: #F97583;">use</span><span style="color: #B392F0;"> std</span><span style="color: #F97583;">::</span><span>{</span></span>
<span class="giallo-l"><span style="color: #B392F0;">    fs</span><span style="color: #F97583;">::</span><span>{</span><span style="color: #79B8FF;">self</span><span>,</span><span style="color: #B392F0;"> File</span><span>},</span></span>
<span class="giallo-l"><span style="color: #B392F0;">    process</span><span style="color: #F97583;">::</span><span style="color: #B392F0;">Command</span><span>,</span></span>
<span class="giallo-l"><span>};</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span>#[test]</span></span>
<span class="giallo-l"><span style="color: #F97583;">fn</span><span style="color: #B392F0;"> run_executable</span><span>()</span><span style="color: #F97583;"> -&gt;</span><span style="color: #B392F0;"> Result</span><span>&lt;(),</span><span style="color: #B392F0;"> Box</span><span>&lt;</span><span style="color: #F97583;">dyn</span><span> std</span><span style="color: #F97583;">::</span><span>error</span><span style="color: #F97583;">::</span><span style="color: #B392F0;">Error</span><span>&gt;&gt; {</span></span>
<span class="giallo-l"><span style="color: #6A737D;">    // You may want to include the calls to trim but depending on your use case you might not.</span></span>
<span class="giallo-l"><span style="color: #6A737D;">    // They are optional but included as they are easier to remove than figure out where to add</span></span>
<span class="giallo-l"><span style="color: #6A737D;">    // Note that input it not trimmed, only expected_output and output</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span style="color: #F97583;">    let</span><span> input_file</span><span style="color: #F97583;"> =</span><span style="color: #B392F0;"> File</span><span style="color: #F97583;">::</span><span style="color: #B392F0;">open</span><span>(</span><span style="color: #9ECBFF;">&quot;input.txt&quot;</span><span>)</span><span style="color: #F97583;">?</span><span>;</span></span>
<span class="giallo-l"><span style="color: #F97583;">    let</span><span> expected_output_filename</span><span style="color: #F97583;"> =</span><span style="color: #9ECBFF;"> &quot;expected_output.txt&quot;</span><span>;</span></span>
<span class="giallo-l"><span style="color: #F97583;">    let</span><span> expected_output</span><span style="color: #F97583;"> =</span><span style="color: #B392F0;"> fs</span><span style="color: #F97583;">::</span><span style="color: #B392F0;">read_to_string</span><span>(expected_output_filename)</span></span>
<span class="giallo-l"><span style="color: #F97583;">        .</span><span style="color: #B392F0;">map_err</span><span>(</span><span style="color: #F97583;">|</span><span>e</span><span style="color: #F97583;">|</span><span style="color: #B392F0;"> format!</span><span>(</span><span style="color: #9ECBFF;">&quot;Failed to load output: {expected_output_filename} Error:{e}&quot;</span><span>))</span><span style="color: #F97583;">?</span></span>
<span class="giallo-l"><span style="color: #F97583;">        .</span><span style="color: #B392F0;">trim</span><span>()</span><span style="color: #6A737D;"> // Trim expected output</span></span>
<span class="giallo-l"><span style="color: #F97583;">        .</span><span style="color: #B392F0;">to_owned</span><span>();</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span style="color: #B392F0;">    Command</span><span style="color: #F97583;">::</span><span style="color: #B392F0;">cargo_bin</span><span>(</span><span style="color: #9ECBFF;">&quot;myapp&quot;</span><span>)</span><span style="color: #F97583;">?</span></span>
<span class="giallo-l"><span style="color: #F97583;">        .</span><span style="color: #B392F0;">stdin</span><span>(input_file)</span></span>
<span class="giallo-l"><span style="color: #F97583;">        .</span><span style="color: #B392F0;">assert</span><span>()</span></span>
<span class="giallo-l"><span style="color: #F97583;">        .</span><span style="color: #B392F0;">stdout</span><span>(</span></span>
<span class="giallo-l"><span style="color: #B392F0;">            predicate</span><span style="color: #F97583;">::</span><span style="color: #B392F0;">str</span><span style="color: #F97583;">::</span><span style="color: #B392F0;">diff</span><span>(expected_output)</span><span style="color: #F97583;">.</span><span style="color: #B392F0;">trim</span><span>(),</span><span style="color: #6A737D;"> // Trims actual output</span></span>
<span class="giallo-l"><span>        );</span></span>
<span class="giallo-l"><span style="color: #B392F0;">    Ok</span><span>(())</span></span>
<span class="giallo-l"><span>}</span></span></code></pre><h1 id="get-input-arguments-to-a-program"><a class="zola-anchor" href="#get-input-arguments-to-a-program" aria-label="Anchor link for: get-input-arguments-to-a-program">Get input arguments to a program</a></h1>
<p>Source: <a rel="noopener external" target="_blank" href="https://doc.rust-lang.org/book/ch12-01-accepting-command-line-arguments.html#saving-the-argument-values-in-variables">https://doc.rust-lang.org/book/ch12-01-accepting-command-line-arguments.html#saving-the-argument-values-in-variables</a></p>
<pre class="giallo" style="color: #E1E4E8; background-color: #24292E;"><code data-lang="rust"><span class="giallo-l"><span style="color: #F97583;">use</span><span style="color: #B392F0;"> std</span><span style="color: #F97583;">::</span><span>env;</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span style="color: #F97583;">fn</span><span style="color: #B392F0;"> main</span><span>() {</span></span>
<span class="giallo-l"><span style="color: #F97583;">    let</span><span> args</span><span style="color: #F97583;">:</span><span style="color: #B392F0;"> Vec</span><span>&lt;</span><span style="color: #B392F0;">String</span><span>&gt;</span><span style="color: #F97583;"> =</span><span style="color: #B392F0;"> env</span><span style="color: #F97583;">::</span><span style="color: #B392F0;">args</span><span>()</span><span style="color: #F97583;">.</span><span style="color: #B392F0;">collect</span><span>();</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span style="color: #F97583;">    let</span><span> query</span><span style="color: #F97583;"> = &amp;</span><span>args[</span><span style="color: #79B8FF;">1</span><span>];</span></span>
<span class="giallo-l"><span style="color: #F97583;">    let</span><span> file_path</span><span style="color: #F97583;"> = &amp;</span><span>args[</span><span style="color: #79B8FF;">2</span><span>];</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span style="color: #B392F0;">    println!</span><span>(</span><span style="color: #9ECBFF;">&quot;Searching for {}&quot;</span><span>, query);</span></span>
<span class="giallo-l"><span style="color: #B392F0;">    println!</span><span>(</span><span style="color: #9ECBFF;">&quot;In file {}&quot;</span><span>, file_path);</span></span>
<span class="giallo-l"><span>}</span></span></code></pre><h1 id="loop-nesting-and-labels"><a class="zola-anchor" href="#loop-nesting-and-labels" aria-label="Anchor link for: loop-nesting-and-labels">Loop nesting and labels</a></h1>
<p>Source: <a rel="noopener external" target="_blank" href="https://doc.rust-lang.org/rust-by-example/flow_control/loop/nested.html">https://doc.rust-lang.org/rust-by-example/flow_control/loop/nested.html</a></p>
<pre class="giallo" style="color: #E1E4E8; background-color: #24292E;"><code data-lang="rust"><span class="giallo-l"><span style="color: #F97583;">fn</span><span style="color: #B392F0;"> main</span><span>() {</span></span>
<span class="giallo-l"><span>    &#39;</span><span style="color: #B392F0;">outer</span><span style="color: #F97583;">: loop</span><span> {</span></span>
<span class="giallo-l"><span style="color: #B392F0;">        println!</span><span>(</span><span style="color: #9ECBFF;">&quot;Entered the outer loop&quot;</span><span>);</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span>        &#39;</span><span style="color: #B392F0;">inner</span><span style="color: #F97583;">: loop</span><span> {</span></span>
<span class="giallo-l"><span style="color: #B392F0;">            println!</span><span>(</span><span style="color: #9ECBFF;">&quot;Entered the inner loop&quot;</span><span>);</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span style="color: #6A737D;">            // This would break only the inner loop</span></span>
<span class="giallo-l"><span style="color: #6A737D;">            //break;</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span style="color: #6A737D;">            // This breaks the outer loop</span></span>
<span class="giallo-l"><span style="color: #F97583;">            break</span><span> &#39;</span><span style="color: #B392F0;">outer</span><span>;</span></span>
<span class="giallo-l"><span>        }</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span style="color: #B392F0;">        println!</span><span>(</span><span style="color: #9ECBFF;">&quot;This point will never be reached&quot;</span><span>);</span></span>
<span class="giallo-l"><span>    }</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span style="color: #B392F0;">    println!</span><span>(</span><span style="color: #9ECBFF;">&quot;Exited the outer loop&quot;</span><span>);</span></span>
<span class="giallo-l"><span>}</span></span></code></pre><h1 id="float-eq-and-ord-wrapper"><a class="zola-anchor" href="#float-eq-and-ord-wrapper" aria-label="Anchor link for: float-eq-and-ord-wrapper">Float Eq and Ord Wrapper</a></h1>
<p>This may be better served by using the crate float_ord. See <a href="https://dev.chester.wykies.com/rust/refs/#useful-crates">useful crate</a></p>
<pre class="giallo" style="color: #E1E4E8; background-color: #24292E;"><code data-lang="rust"><span class="giallo-l"><span>#[derive(</span><span style="color: #B392F0;">Debug</span><span>,</span><span style="color: #B392F0;"> Clone</span><span>,</span><span style="color: #B392F0;"> Copy</span><span>,</span><span style="color: #B392F0;"> PartialEq</span><span>)]</span></span>
<span class="giallo-l"><span style="color: #6A737D;">/// Wraps a float and implements Ord but panics if value is NaN</span></span>
<span class="giallo-l"><span style="color: #F97583;">struct</span><span style="color: #B392F0;"> FloatNonNAN</span><span>(</span><span style="color: #B392F0;">f64</span><span>);</span></span>
<span class="giallo-l"><span style="color: #F97583;">impl</span><span style="color: #B392F0;"> FloatNonNAN</span><span> {</span></span>
<span class="giallo-l"><span style="color: #6A737D;">    /// Creates a new [Self] with constraint that value cannot be NAN or function panics</span></span>
<span class="giallo-l"><span style="color: #F97583;">    pub fn</span><span style="color: #B392F0;"> new</span><span>(value</span><span style="color: #F97583;">:</span><span style="color: #B392F0;"> f64</span><span>)</span><span style="color: #F97583;"> -&gt;</span><span style="color: #79B8FF;"> Self</span><span> {</span></span>
<span class="giallo-l"><span style="color: #B392F0;">        assert!</span><span>(</span></span>
<span class="giallo-l"><span style="color: #F97583;">            !</span><span>value</span><span style="color: #F97583;">.</span><span style="color: #B392F0;">is_nan</span><span>(),</span></span>
<span class="giallo-l"><span style="color: #9ECBFF;">            &quot;NAN is not allowed as it is not equal to itself and thus invalid for an impl of Ord&quot;</span></span>
<span class="giallo-l"><span>        );</span></span>
<span class="giallo-l"><span style="color: #79B8FF;">        Self</span><span>(value)</span></span>
<span class="giallo-l"><span>    }</span></span>
<span class="giallo-l"><span>}</span></span>
<span class="giallo-l"><span style="color: #F97583;">impl</span><span style="color: #B392F0;"> Eq</span><span style="color: #F97583;"> for</span><span style="color: #B392F0;"> FloatNonNAN</span><span> {}</span></span>
<span class="giallo-l"><span style="color: #F97583;">impl</span><span style="color: #B392F0;"> Ord</span><span style="color: #F97583;"> for</span><span style="color: #B392F0;"> FloatNonNAN</span><span> {</span></span>
<span class="giallo-l"><span style="color: #F97583;">    fn</span><span style="color: #B392F0;"> cmp</span><span>(</span><span style="color: #F97583;">&amp;</span><span style="color: #79B8FF;">self</span><span>, other</span><span style="color: #F97583;">: &amp;</span><span style="color: #79B8FF;">Self</span><span>)</span><span style="color: #F97583;"> -&gt;</span><span style="color: #B392F0;"> std</span><span style="color: #F97583;">::</span><span style="color: #B392F0;">cmp</span><span style="color: #F97583;">::</span><span style="color: #B392F0;">Ordering</span><span> {</span></span>
<span class="giallo-l"><span style="color: #79B8FF;">        self</span><span style="color: #F97583;">.</span><span style="color: #79B8FF;">0</span></span>
<span class="giallo-l"><span style="color: #F97583;">            .</span><span style="color: #B392F0;">partial_cmp</span><span>(</span><span style="color: #F97583;">&amp;</span><span>other</span><span style="color: #F97583;">.</span><span style="color: #79B8FF;">0</span><span>)</span></span>
<span class="giallo-l"><span style="color: #F97583;">            .</span><span style="color: #B392F0;">expect</span><span>(</span><span style="color: #9ECBFF;">&quot;This should work unless one of them is NAN&quot;</span><span>)</span></span>
<span class="giallo-l"><span>    }</span></span>
<span class="giallo-l"><span>}</span></span>
<span class="giallo-l"><span style="color: #F97583;">impl</span><span style="color: #B392F0;"> PartialOrd</span><span style="color: #F97583;"> for</span><span style="color: #B392F0;"> FloatNonNAN</span><span> {</span></span>
<span class="giallo-l"><span style="color: #F97583;">    fn</span><span style="color: #B392F0;"> partial_cmp</span><span>(</span><span style="color: #F97583;">&amp;</span><span style="color: #79B8FF;">self</span><span>, other</span><span style="color: #F97583;">: &amp;</span><span style="color: #79B8FF;">Self</span><span>)</span><span style="color: #F97583;"> -&gt;</span><span style="color: #B392F0;"> Option</span><span>&lt;std</span><span style="color: #F97583;">::</span><span>cmp</span><span style="color: #F97583;">::</span><span style="color: #B392F0;">Ordering</span><span>&gt; {</span></span>
<span class="giallo-l"><span style="color: #79B8FF;">        self</span><span style="color: #F97583;">.</span><span style="color: #79B8FF;">0.</span><span style="color: #B392F0;">partial_cmp</span><span>(</span><span style="color: #F97583;">&amp;</span><span>other</span><span style="color: #F97583;">.</span><span style="color: #79B8FF;">0</span><span>)</span></span>
<span class="giallo-l"><span>    }</span></span>
<span class="giallo-l"><span>}</span></span>
<span class="giallo-l"><span style="color: #F97583;">impl</span><span style="color: #B392F0;"> AsRef</span><span>&lt;</span><span style="color: #B392F0;">f64</span><span>&gt;</span><span style="color: #F97583;"> for</span><span style="color: #B392F0;"> FloatNonNAN</span><span> {</span></span>
<span class="giallo-l"><span style="color: #F97583;">    fn</span><span style="color: #B392F0;"> as_ref</span><span>(</span><span style="color: #F97583;">&amp;</span><span style="color: #79B8FF;">self</span><span>)</span><span style="color: #F97583;"> -&gt; &amp;</span><span style="color: #B392F0;">f64</span><span> {</span></span>
<span class="giallo-l"><span style="color: #F97583;">        &amp;</span><span style="color: #79B8FF;">self</span><span style="color: #F97583;">.</span><span style="color: #79B8FF;">0</span></span>
<span class="giallo-l"><span>    }</span></span>
<span class="giallo-l"><span>}</span></span>
<span class="giallo-l"><span style="color: #F97583;">impl</span><span style="color: #B392F0;"> PartialEq</span><span>&lt;</span><span style="color: #B392F0;">f64</span><span>&gt;</span><span style="color: #F97583;"> for</span><span style="color: #B392F0;"> FloatNonNAN</span><span> {</span></span>
<span class="giallo-l"><span style="color: #F97583;">    fn</span><span style="color: #B392F0;"> eq</span><span>(</span><span style="color: #F97583;">&amp;</span><span style="color: #79B8FF;">self</span><span>, other</span><span style="color: #F97583;">: &amp;</span><span style="color: #B392F0;">f64</span><span>)</span><span style="color: #F97583;"> -&gt;</span><span style="color: #B392F0;"> bool</span><span> {</span></span>
<span class="giallo-l"><span style="color: #F97583;">        &amp;</span><span style="color: #79B8FF;">self</span><span style="color: #F97583;">.</span><span style="color: #79B8FF;">0</span><span style="color: #F97583;"> ==</span><span> other</span></span>
<span class="giallo-l"><span>    }</span></span>
<span class="giallo-l"><span>}</span></span>
<span class="giallo-l"><span style="color: #F97583;">impl</span><span style="color: #B392F0;"> From</span><span>&lt;</span><span style="color: #B392F0;">FloatNonNAN</span><span>&gt;</span><span style="color: #F97583;"> for</span><span style="color: #B392F0;"> f64</span><span> {</span></span>
<span class="giallo-l"><span style="color: #F97583;">    fn</span><span style="color: #B392F0;"> from</span><span>(value</span><span style="color: #F97583;">:</span><span style="color: #B392F0;"> FloatNonNAN</span><span>)</span><span style="color: #F97583;"> -&gt;</span><span style="color: #79B8FF;"> Self</span><span> {</span></span>
<span class="giallo-l"><span>        value</span><span style="color: #F97583;">.</span><span style="color: #79B8FF;">0</span></span>
<span class="giallo-l"><span>    }</span></span>
<span class="giallo-l"><span>}</span></span>
<span class="giallo-l"><span style="color: #F97583;">impl</span><span style="color: #B392F0;"> std</span><span style="color: #F97583;">::</span><span style="color: #B392F0;">ops</span><span style="color: #F97583;">::</span><span style="color: #B392F0;">Mul</span><span style="color: #F97583;"> for</span><span style="color: #B392F0;"> FloatNonNAN</span><span> {</span></span>
<span class="giallo-l"><span style="color: #F97583;">    type</span><span style="color: #B392F0;"> Output</span><span style="color: #F97583;"> =</span><span style="color: #79B8FF;"> Self</span><span>;</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span style="color: #F97583;">    fn</span><span style="color: #B392F0;"> mul</span><span>(</span><span style="color: #79B8FF;">self</span><span>, rhs</span><span style="color: #F97583;">:</span><span style="color: #79B8FF;"> Self</span><span>)</span><span style="color: #F97583;"> -&gt;</span><span style="color: #79B8FF;"> Self</span><span style="color: #F97583;">::</span><span style="color: #B392F0;">Output</span><span> {</span></span>
<span class="giallo-l"><span style="color: #B392F0;">        FloatNonNAN</span><span style="color: #F97583;">::</span><span style="color: #B392F0;">new</span><span>(</span><span style="color: #79B8FF;">self</span><span style="color: #F97583;">.</span><span style="color: #79B8FF;">0</span><span style="color: #F97583;"> *</span><span> rhs</span><span style="color: #F97583;">.</span><span style="color: #79B8FF;">0</span><span>)</span></span>
<span class="giallo-l"><span>    }</span></span>
<span class="giallo-l"><span>}</span></span></code></pre><h1 id="collect-into-a-result"><a class="zola-anchor" href="#collect-into-a-result" aria-label="Anchor link for: collect-into-a-result">Collect into a result</a></h1>
<p>One fail means the first error is returned (Remember this from the rust book but couldn’t find it).
Mostly needed when I’m using iterators and need to do a map step that may fail.
Usual issue is not remembering to wrap the good option in Ok.</p>
<pre class="giallo" style="color: #E1E4E8; background-color: #24292E;"><code data-lang="rust"><span class="giallo-l"><span style="color: #F97583;">fn</span><span style="color: #B392F0;"> main</span><span>()</span><span style="color: #F97583;"> -&gt;</span><span style="color: #B392F0;"> Result</span><span>&lt;(),</span><span style="color: #B392F0;"> Box</span><span>&lt;</span><span style="color: #F97583;">dyn</span><span> std</span><span style="color: #F97583;">::</span><span>error</span><span style="color: #F97583;">::</span><span style="color: #B392F0;">Error</span><span>&gt;&gt; {</span></span>
<span class="giallo-l"><span style="color: #F97583;">    let</span><span> numbers</span><span style="color: #F97583;">:</span><span style="color: #B392F0;"> Vec</span><span>&lt;</span><span style="color: #B392F0;">u8</span><span>&gt;</span><span style="color: #F97583;"> =</span><span> (</span><span style="color: #79B8FF;">0</span><span style="color: #F97583;">..</span><span style="color: #79B8FF;">10</span><span>)</span><span style="color: #F97583;">.</span><span style="color: #B392F0;">step_by</span><span>(</span><span style="color: #79B8FF;">2</span><span>)</span><span style="color: #F97583;">.</span><span style="color: #B392F0;">collect</span><span>();</span></span>
<span class="giallo-l"><span style="color: #F97583;">    let</span><span> all_even</span><span style="color: #F97583;">:</span><span style="color: #B392F0;"> Vec</span><span>&lt;</span><span style="color: #B392F0;">u8</span><span>&gt;</span><span style="color: #F97583;"> =</span><span> numbers</span></span>
<span class="giallo-l"><span style="color: #F97583;">        .</span><span style="color: #B392F0;">iter</span><span>()</span></span>
<span class="giallo-l"><span style="color: #F97583;">        .</span><span style="color: #B392F0;">cloned</span><span>()</span></span>
<span class="giallo-l"><span style="color: #F97583;">        .</span><span style="color: #B392F0;">map</span><span>(</span><span style="color: #F97583;">|</span><span>x</span><span style="color: #F97583;">|</span><span> {</span></span>
<span class="giallo-l"><span style="color: #F97583;">            if</span><span> x</span><span style="color: #F97583;"> %</span><span style="color: #79B8FF;"> 2</span><span style="color: #F97583;"> ==</span><span style="color: #79B8FF;"> 0</span><span> {</span></span>
<span class="giallo-l"><span style="color: #B392F0;">                Ok</span><span>(x)</span></span>
<span class="giallo-l"><span>            }</span><span style="color: #F97583;"> else</span><span> {</span></span>
<span class="giallo-l"><span style="color: #B392F0;">                Err</span><span>(</span><span style="color: #9ECBFF;">&quot;Oops we founds a odd number&quot;</span><span>)</span></span>
<span class="giallo-l"><span>            }</span></span>
<span class="giallo-l"><span>        })</span></span>
<span class="giallo-l"><span style="color: #F97583;">        .</span><span style="color: #B392F0;">collect</span><span style="color: #F97583;">::</span><span>&lt;</span><span style="color: #B392F0;">Result</span><span>&lt;</span><span style="color: #B392F0;">Vec</span><span>&lt;</span><span style="color: #B392F0;">u8</span><span>&gt;, _&gt;&gt;()</span><span style="color: #F97583;">?</span><span>;</span></span>
<span class="giallo-l"><span style="color: #B392F0;">    println!</span><span>(</span><span style="color: #9ECBFF;">&quot;{all_even:?}&quot;</span><span>);</span></span>
<span class="giallo-l"><span style="color: #B392F0;">    Ok</span><span>(())</span></span>
<span class="giallo-l"><span>}</span></span></code></pre><h1 id="get-number-of-seconds-until-midnight"><a class="zola-anchor" href="#get-number-of-seconds-until-midnight" aria-label="Anchor link for: get-number-of-seconds-until-midnight">Get number of seconds until midnight</a></h1>
<p>Source: <a rel="noopener external" target="_blank" href="https://stackoverflow.com/questions/47708305/calculate-the-duration-between-now-and-the-next-midnight-using-chrono">https://stackoverflow.com/questions/47708305/calculate-the-duration-between-now-and-the-next-midnight-using-chrono</a></p>
<p>Requires the <a rel="noopener external" target="_blank" href="https://crates.io/crates/chrono">chrono</a> crate.</p>
<pre class="giallo" style="color: #E1E4E8; background-color: #24292E;"><code data-lang="rust"><span class="giallo-l"><span style="color: #F97583;">fn</span><span style="color: #B392F0;"> main</span><span>() {</span></span>
<span class="giallo-l"><span style="color: #F97583;">    let</span><span> duration</span><span style="color: #F97583;"> =</span><span style="color: #B392F0;"> seconds_to</span><span>(</span><span style="color: #79B8FF;">1</span><span>,</span><span style="color: #79B8FF;"> 0</span><span>,</span><span style="color: #79B8FF;"> 0</span><span>,</span><span style="color: #79B8FF;"> 0</span><span>)</span><span style="color: #F97583;">.</span><span style="color: #B392F0;">unwrap</span><span>();</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span style="color: #B392F0;">    println!</span><span>(</span><span style="color: #9ECBFF;">&quot;Duration until midnight {duration:?}&quot;</span><span>);</span></span>
<span class="giallo-l"><span>}</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span style="color: #F97583;">fn</span><span style="color: #B392F0;"> seconds_to</span><span>(days</span><span style="color: #F97583;">:</span><span style="color: #B392F0;"> i64</span><span>, hour</span><span style="color: #F97583;">:</span><span style="color: #B392F0;"> u32</span><span>, min</span><span style="color: #F97583;">:</span><span style="color: #B392F0;"> u32</span><span>, sec</span><span style="color: #F97583;">:</span><span style="color: #B392F0;"> u32</span><span>)</span><span style="color: #F97583;"> -&gt;</span><span style="color: #B392F0;"> Option</span><span>&lt;std</span><span style="color: #F97583;">::</span><span>time</span><span style="color: #F97583;">::</span><span style="color: #B392F0;">Duration</span><span>&gt; {</span></span>
<span class="giallo-l"><span style="color: #F97583;">    let</span><span> now</span><span style="color: #F97583;"> =</span><span style="color: #B392F0;"> chrono</span><span style="color: #F97583;">::</span><span style="color: #B392F0;">Local</span><span style="color: #F97583;">::</span><span style="color: #B392F0;">now</span><span>();</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span style="color: #F97583;">    let</span><span> new_date_time</span><span style="color: #F97583;"> =</span><span> (now</span><span style="color: #F97583;"> +</span><span style="color: #B392F0;"> chrono</span><span style="color: #F97583;">::</span><span style="color: #B392F0;">Duration</span><span style="color: #F97583;">::</span><span style="color: #B392F0;">days</span><span>(days))</span></span>
<span class="giallo-l"><span style="color: #F97583;">        .</span><span style="color: #B392F0;">date_naive</span><span>()</span></span>
<span class="giallo-l"><span style="color: #F97583;">        .</span><span style="color: #B392F0;">and_hms_opt</span><span>(hour, min, sec)</span><span style="color: #F97583;">?</span><span>;</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span style="color: #F97583;">    match</span><span> new_date_time</span></span>
<span class="giallo-l"><span style="color: #F97583;">        .</span><span style="color: #B392F0;">signed_duration_since</span><span>(now</span><span style="color: #F97583;">.</span><span style="color: #B392F0;">naive_local</span><span>())</span></span>
<span class="giallo-l"><span style="color: #F97583;">        .</span><span style="color: #B392F0;">to_std</span><span>()</span></span>
<span class="giallo-l"><span>    {</span></span>
<span class="giallo-l"><span style="color: #B392F0;">        Ok</span><span>(result)</span><span style="color: #F97583;"> =&gt;</span><span style="color: #B392F0;"> Some</span><span>(result),</span></span>
<span class="giallo-l"><span style="color: #B392F0;">        Err</span><span>(e)</span><span style="color: #F97583;"> =&gt;</span><span> {</span></span>
<span class="giallo-l"><span style="color: #B392F0;">            dbg!</span><span>(e);</span><span style="color: #6A737D;"> // Might want to log this error or return a result as suitable to your application</span></span>
<span class="giallo-l"><span style="color: #B392F0;">            None</span></span>
<span class="giallo-l"><span>        }</span></span>
<span class="giallo-l"><span>    }</span></span>
<span class="giallo-l"><span>}</span></span></code></pre><h1 id="random"><a class="zola-anchor" href="#random" aria-label="Anchor link for: random">Random</a></h1>
<p>Source: <a rel="noopener external" target="_blank" href="https://rust-random.github.io/book/guide-values.html#the-rng-trait">https://rust-random.github.io/book/guide-values.html#the-rng-trait</a></p>
<p>Copied here for faster lookup without having to search for it again.</p>
<pre class="giallo" style="color: #E1E4E8; background-color: #24292E;"><code data-lang="shellscript"><span class="giallo-l"><span style="color: #B392F0;">cargo</span><span style="color: #9ECBFF;"> add rand</span></span></code></pre><pre class="giallo" style="color: #E1E4E8; background-color: #24292E;"><code data-lang="rust"><span class="giallo-l"><span style="color: #F97583;">use</span><span style="color: #B392F0;"> rand</span><span style="color: #F97583;">::</span><span style="color: #B392F0;">Rng</span><span>;</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span style="color: #F97583;">fn</span><span style="color: #B392F0;"> main</span><span>() {</span></span>
<span class="giallo-l"><span style="color: #F97583;">    let mut</span><span> rng</span><span style="color: #F97583;"> =</span><span style="color: #B392F0;"> rand</span><span style="color: #F97583;">::</span><span style="color: #B392F0;">thread_rng</span><span>();</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span style="color: #6A737D;">    // an unbiased integer over the entire range:</span></span>
<span class="giallo-l"><span style="color: #F97583;">    let</span><span> i</span><span style="color: #F97583;">:</span><span style="color: #B392F0;"> i32</span><span style="color: #F97583;"> =</span><span> rng</span><span style="color: #F97583;">.</span><span style="color: #B392F0;">gen</span><span>();</span></span>
<span class="giallo-l"><span style="color: #B392F0;">    println!</span><span>(</span><span style="color: #9ECBFF;">&quot;i = {i}&quot;</span><span>);</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span style="color: #6A737D;">    // a uniformly distributed value between 0 and 1:</span></span>
<span class="giallo-l"><span style="color: #F97583;">    let</span><span> x</span><span style="color: #F97583;">:</span><span style="color: #B392F0;"> f64</span><span style="color: #F97583;"> =</span><span> rng</span><span style="color: #F97583;">.</span><span style="color: #B392F0;">gen</span><span>();</span></span>
<span class="giallo-l"><span style="color: #B392F0;">    println!</span><span>(</span><span style="color: #9ECBFF;">&quot;x = {x}&quot;</span><span>);</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span style="color: #6A737D;">    // simulate rolling a die:</span></span>
<span class="giallo-l"><span style="color: #B392F0;">    println!</span><span>(</span><span style="color: #9ECBFF;">&quot;roll = {}&quot;</span><span>, rng</span><span style="color: #F97583;">.</span><span style="color: #B392F0;">gen_range</span><span>(</span><span style="color: #79B8FF;">1</span><span style="color: #F97583;">..=</span><span style="color: #79B8FF;">6</span><span>));</span></span>
<span class="giallo-l"><span>}</span></span></code></pre><h1 id="wrap-a-call-to-the-format-macro"><a class="zola-anchor" href="#wrap-a-call-to-the-format-macro" aria-label="Anchor link for: wrap-a-call-to-the-format-macro">Wrap a call to the format macro</a></h1>
<p>Source: <a rel="noopener external" target="_blank" href="https://stackoverflow.com/questions/32289605/how-do-i-write-a-wrapper-for-a-macro-without-repeating-the-rules">https://stackoverflow.com/questions/32289605/how-do-i-write-a-wrapper-for-a-macro-without-repeating-the-rules</a></p>
<p>Useful when you want provide the same calling syntax as <code>format!()</code> but you want to perform additional steps.
In this example postfix the text with error and add the position it occurred in the code.</p>
<pre class="giallo" style="color: #E1E4E8; background-color: #24292E;"><code data-lang="rust"><span class="giallo-l"><span>#[macro_export]</span></span>
<span class="giallo-l"><span style="color: #B392F0;">macro_rules! internal_error</span><span> {</span></span>
<span class="giallo-l"><span>    (</span><span style="color: #F97583;">$</span><span>(</span><span style="color: #F97583;">$</span><span>arg</span><span style="color: #F97583;">:</span><span>tt)</span><span style="color: #F97583;">*</span><span>)</span><span style="color: #F97583;"> =&gt;</span><span> {{</span></span>
<span class="giallo-l"><span style="color: #F97583;">        let</span><span> res</span><span style="color: #F97583;"> =</span><span style="color: #B392F0;"> format!</span><span>(</span><span style="color: #F97583;">$</span><span>(</span><span style="color: #F97583;">$</span><span>arg)</span><span style="color: #F97583;">*</span><span>);</span></span>
<span class="giallo-l"><span style="color: #F97583;">        let</span><span> internal_error_msg</span><span style="color: #F97583;"> =</span><span style="color: #B392F0;"> format!</span><span>(</span></span>
<span class="giallo-l"><span style="color: #9ECBFF;">            &quot;{}</span><span style="color: #79B8FF;">\n</span><span style="color: #9ECBFF;">internal error: {}:{}:{}&quot;</span><span>,</span></span>
<span class="giallo-l"><span>            res,</span></span>
<span class="giallo-l"><span style="color: #B392F0;">            file!</span><span>(),</span></span>
<span class="giallo-l"><span style="color: #B392F0;">            line!</span><span>(),</span></span>
<span class="giallo-l"><span style="color: #B392F0;">            column!</span><span>()</span></span>
<span class="giallo-l"><span>        );</span></span>
<span class="giallo-l"><span style="color: #B392F0;">        tracing</span><span style="color: #F97583;">::</span><span style="color: #B392F0;">error!</span><span>(</span><span style="color: #F97583;">?</span><span>internal_error_msg);</span></span>
<span class="giallo-l"><span>        internal_error_msg</span></span>
<span class="giallo-l"><span>    }};</span></span>
<span class="giallo-l"><span>}</span></span></code></pre>
    </article>

    <div class="sblock">
      <div class="blockdiv">
        <a class="b s150" href="https://dev.chester.wykies.com/tags/rust/">Series</a><br>

          
          
      <a href="https://dev.chester.wykies.com/rust/conditional-compilation/">Conditional Compilation</a><br>

          
            <details>
              <summary>More...</summary>
            </details>
            <div class="hidden_li">
                <a href="https://dev.chester.wykies.com/rust/install/">Install</a><br>
                <a href="https://dev.chester.wykies.com/rust/crate-serde/">Crate Serde</a><br>
                <a href="https://dev.chester.wykies.com/rust/refs/">References</a><br>
                <a href="https://dev.chester.wykies.com/rust/cargo/">Cargo</a><br>
                <a href="https://dev.chester.wykies.com/rust/toolchain/">Toolchain (Nightly)</a><br>
                <a href="https://dev.chester.wykies.com/rust/string-formatting/">String Formatting</a><br>
                <a href="https://dev.chester.wykies.com/rust/time/">Time</a><br>
                <a href="https://dev.chester.wykies.com/rust/crate-tokio/">Crate Tokio</a><br>
                <a href="https://dev.chester.wykies.com/rust/publish-crate/">Publish Crate</a><br>
            </div>

          

          
            <a href="https://dev.chester.wykies.com/rust/rustfmt/">rustfmt</a><br>
            <a href="https://dev.chester.wykies.com/rust/scripts/">Single file script</a><br>

          
            
      <a class="scur" href="https://dev.chester.wykies.com/rust/snippets/">Snippets</a><br>
    

          
            <a href="https://dev.chester.wykies.com/rust/ci/">CI</a><br>
          
            <a href="https://dev.chester.wykies.com/rust/pattern-typestate/">Pattern Type State</a><br>
          
            <details>
              <summary>More...</summary>
            </details>
            <div class="hidden_li">
                <a href="https://dev.chester.wykies.com/rust/wasm/">WASM</a><br>
                <a href="https://dev.chester.wykies.com/rust/create-new-crate/">Create New Crate</a><br>
                <a href="https://dev.chester.wykies.com/rust/documentation/">Documentation</a><br>
                <a href="https://dev.chester.wykies.com/rust/json/">JSON</a><br>
                <a href="https://dev.chester.wykies.com/rust/pattern-builder/">Pattern Builder</a><br>
                <a href="https://dev.chester.wykies.com/rust/testing/">Testing</a><br>
                <a href="https://dev.chester.wykies.com/rust/byte-collections/">Working with collections of bytes</a><br>
                <a href="https://dev.chester.wykies.com/rust/thoughts/">Thoughts about rust</a><br>
                <a href="https://dev.chester.wykies.com/rust/areweyet/">Are we yet</a><br>
                <a href="https://dev.chester.wykies.com/rust/std-once/">OnceLock</a><br>
                <a href="https://dev.chester.wykies.com/rust/crate-actix/">Crate Actix Web</a><br>
                <a href="https://dev.chester.wykies.com/rust/stack-overflow/">Stack Overflow</a><br>
                <a href="https://dev.chester.wykies.com/rust/crate-clap/">Crate Clap</a><br>
                <a href="https://dev.chester.wykies.com/rust/crate-poll-promise/">Crate Poll Promise</a><br>
                <a href="https://dev.chester.wykies.com/rust/crate-insta/">Crate Insta</a><br>
                <a href="https://dev.chester.wykies.com/rust/tips/">Tips</a><br>
                <a href="https://dev.chester.wykies.com/rust/create-new-egui-project/">Create new egui project</a><br>
                <a href="https://dev.chester.wykies.com/rust/crate-csv/">Crate CSV</a><br>
                <a href="https://dev.chester.wykies.com/rust/crate-egui/">Crate egui</a><br>
                <a href="https://dev.chester.wykies.com/rust/iterators/">Iterators</a><br>
                <a href="https://dev.chester.wykies.com/rust/crate-tracing-subscriber/">Crate Tracing Subscriber</a><br>
                <a href="https://dev.chester.wykies.com/rust/regex/">Regex</a><br>
                <a href="https://dev.chester.wykies.com/rust/vscode/">vscode</a><br>
                <a href="https://dev.chester.wykies.com/rust/enum-conversion/">Enum Conversion</a><br>
                <a href="https://dev.chester.wykies.com/rust/macros/">Macros</a><br>
                <a href="https://dev.chester.wykies.com/rust/crate-lettre/">lettre</a><br>
            </div>
        
      <a href="https://dev.chester.wykies.com/rust/google-apis/">Google APIs</a><br>

        
      </div>
      <div class="blockdiv sticky">
        <a class="b s150" href="#">Index</a>
        <div>
          <a href="#library-candidates">Library Candidates</a>
        </div>
        <div class="hpad">
          <a href="#read-number-from-stdin"><small>- Read number from stdin</small></a>
        </div>
        <div class="hpad">
          <a href="#read-file-line-by-line"><small>- Read file (line by line)</small></a>
        </div>
        <div class="hpad">
          <a href="#read-file-to-string"><small>- Read file to string</small></a>
        </div>
        <div class="hpad">
          <a href="#write-string-to-a-file"><small>- Write string to a file</small></a>
        </div>
        <div class="hpad">
          <a href="#print-without-new-line-and-flush"><small>- Print without new line (and flush)</small></a>
        </div>
        <div class="hpad">
          <a href="#add-an-extension-to-a-path"><small>- Add an extension to a path</small></a>
        </div>
        <div class="hpad">
          <a href="#add-commas-to-number-for-display"><small>- Add commas to number for display</small></a>
        </div>
        <div class="hpad">
          <a href="#replace-escaped-special-characters-with-the-actual-special-characters"><small>- Replace escaped special characters with the actual special characters</small></a>
        </div>
        <div>
          <a href="#tests">Tests</a>
        </div>
        <div class="hpad">
          <a href="#unit-tests"><small>- Unit tests</small></a>
        </div>
        <div class="hpad">
          <a href="#panic-expectation"><small>- Panic expectation</small></a>
        </div>
        <div class="hpad">
          <a href="#run-cli-app-to-test-it"><small>- Run CLI App to test it</small></a>
        </div>
        <div>
          <a href="#get-input-arguments-to-a-program">Get input arguments to a program</a>
        </div>
        <div>
          <a href="#loop-nesting-and-labels">Loop nesting and labels</a>
        </div>
        <div>
          <a href="#float-eq-and-ord-wrapper">Float Eq and Ord Wrapper</a>
        </div>
        <div>
          <a href="#collect-into-a-result">Collect into a result</a>
        </div>
        <div>
          <a href="#get-number-of-seconds-until-midnight">Get number of seconds until midnight</a>
        </div>
        <div>
          <a href="#random">Random</a>
        </div>
        <div>
          <a href="#wrap-a-call-to-the-format-macro">Wrap a call to the format macro</a>
        </div>
      </div>
    </div>
  </main>
  <footer>
    <hr />
    <div class="c">
      <nav class="tpad"><div><a type="application/atom+xml" href="https://dev.chester.wykies.com/atom.xml" target="_blank" title="Chester Wyke Atom Feed"><i type="Button" class="svg rss" title="Chester Wyke Atom Feed"></i></a><a href="https://www.linkedin.com/in/cwyke/" target="_blank" title="LinkedIn"><i type="Button" class="svg linkedin" title="LinkedIn"></i></a><a href="https://github.com/c-git/" target="_blank" title="Github"><i type="Button" class="svg github" title="Github"></i></a></div></nav>
      <nav class="vpad">
        <a class="rpad s90" href="https://dev.chester.wykies.com/site-definitions/"> Definitions </a>
        <a class="rpad s90" href="https://dev.chester.wykies.com/privacy/"> Privacy </a>
        <a class="rpad s90" href="https://dev.chester.wykies.com/sitemap.xml" target="_blank"> Sitemap </a>
      </nav><a href="https://github.com/c-git/c-git.github.io/edit/main/content/rust&#x2F;snippets.md" target="_blank">Edit this page on GitHub</a>
          
      <p class="s80"> © 2022-<span id="year">2026</span> Chester Wyke</p>
      <p class="s80">Powered by <a href="https://www.getzola.org/" target="_blank">Zola</a> & <a href="https://github.com/jieiku/abridge/" target="_blank">Abridge</a></p>
    </div>
  </footer><span class="topout">
<span class="topleft"> </span><a href="#" class="top" title="Back to Top">&cuwed;</a>
</span>
</body>
</html>
